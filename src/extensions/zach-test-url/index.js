/* eslint-disable max-len */
const icon = 'data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMjBweCIgaGVpZ2h0PSIyMHB4IiB2aWV3Qm94PSIwIDAgMjAgMjAiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjIgKDY3MTQ1KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5FeHRlbnNpb25zL1NvZnR3YXJlL1RleHQtdG8tU3BlZWNoLU1lbnU8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iRXh0ZW5zaW9ucy9Tb2Z0d2FyZS9UZXh0LXRvLVNwZWVjaC1NZW51IiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0idGV4dDJzcGVlY2giIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIuMDAwMDAwLCAyLjAwMDAwMCkiIGZpbGwtcnVsZT0ibm9uemVybyI+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik01Ljc1LDguODM0NjcxNzMgQzUuNzUsOC4zMjY5NjM0NCA1LjAwMzAwNzI3LDguMDQyMjEzNzEgNC41NTYyODAxMiw4LjQ0NDE0OTk5IEwzLjIwNjI4MDEyLDkuNTI1MzU3MDIgQzIuNjk2NzMzNzgsOS45MzM0NDk2OCAyLjAzNzQ4Njc1LDEwLjE2NTg3ODggMS4zNSwxMC4xNjU4Nzg4IEwxLjE1LDEwLjE2NTg3ODggQzAuNjMyNTk2MTY1LDEwLjE2NTg3ODggMC4yNSwxMC41MTA2MDAyIDAuMjUsMTAuOTUyMDM1NSBMMC4yNSwxMy4wNjkzOTkzIEMwLjI1LDEzLjUxMDgzNDYgMC42MzI1OTYxNjUsMTMuODU1NTU2IDEuMTUsMTMuODU1NTU2IEwxLjM1LDEzLjg1NTU1NiBDMi4wNzg3Nzg0MSwxMy44NTU1NTYgMi43MjY4NjE2MSwxNC4wNjY3NjM2IDMuMjU5ODYwNDksMTQuNDk5IEw0LjU1OTIwMTQ3LDE1LjU3OTY2MDggQzUuMDEzMDkyNzYsMTUuOTU0NTM5NiA1Ljc1LDE1LjY3MzYzNDQgNS43NSwxNS4xNDE3MTI4IEw1Ljc1LDguODM0NjcxNzMgWiIgaWQ9InNwZWFrZXIiIHN0cm9rZS1vcGFjaXR5PSIwLjE1IiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iMC41IiBmaWxsPSIjNEQ0RDREIj48L3BhdGg+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMC43MDQ4MzEzLDggQzkuNzkwNjc0NjgsOS4xMzExNDg0NyA4LjMwNjYxODQsOS43MTQyODU3MSA3LjgzMzMzMzMzLDkuNzE0Mjg1NzEgQzcuODMzMzMzMzMsOS43MTQyODU3MSA3LjUsOS43MTQyODU3MSA3LjUsOS4zODA5NTIzOCBDNy41LDkuMDg1MjI2ODQgOC4wNjIyMDE2OCw4LjkwMTk0MTY0IDguMTg5MDYwNjcsNy41Njc1NDA1OCBDNi44ODk5Njk5MSw2LjkwNjc5MDA1IDYsNS41NTczMjY4MyA2LDQgQzYsMS43OTA4NjEgNy43OTA4NjEsNC4wNTgxMjI1MWUtMTYgMTAsMCBMMTIsMCBDMTQuMjA5MTM5LC00LjA1ODEyMjUxZS0xNiAxNiwxLjc5MDg2MSAxNiw0IEMxNiw2LjIwOTEzOSAxNC4yMDkxMzksOCAxMiw4IEwxMC43MDQ4MzEzLDggWiIgaWQ9InNwZWVjaCIgZmlsbD0iIzBFQkQ4QyI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+';

/*

class DataStructures{
    constructor (){}

    getInfo () {
        return {
            id: 'dataStructures',
            name: 'DateStructures',

            colour: '#8BC34A',
            colourSecondary: '#7CB342',
            colourTertiary: '#689F38',

            menuIconURI: icon,

            blocks: [
                {
                    opcode: 'value',
                    blockType: Scratch.BlockType.REPORTER,
                    text: 'Value'
                },
                {
                    opcode: 'setValue',
                    blockType: Scratch.BlockType.COMMAND,
                    text: 'Set Value to [VALUE]',
                    arguments: {
                        VALUE: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'Test'
                        }
                    }
                }
            ]

        }
    }

    value (){
        return this.val;
    }

    setValue (args){
        this.val = args.VALUE;
    }
}
Scratch.extensions.register(new DataStructures());

*/

class Utilities {

    constructor () {
    }

    getInfo () {
        return {
            id: 'utilities',
            name: 'Utlities',

            colour: '#8BC34A',
            colourSecondary: '#7CB342',
            colourTertiary: '#689F38',

            menuIconURI: icon,

            blocks: [
                {
                    opcode: 'isExactly',

                    blockType: Scratch.BlockType.BOOLEAN,

                    text: 'is [A] exactly [B]?',
                    arguments: {
                        A: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'apple'
                        },
                        B: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'APPLE'
                        }
                    }
                },
                {
                    opcode: 'isLessOrEqual',

                    blockType: Scratch.BlockType.BOOLEAN,

                    text: '[A] <= [B]',
                    arguments: {
                        A: {
                            type: Scratch.ArgumentType.NUMBER
                        },
                        B: {
                            type: Scratch.ArgumentType.NUMBER,
                            defaultValue: 50
                        }
                    }
                },
                {
                    opcode: 'isMoreOrEqual',

                    blockType: Scratch.BlockType.BOOLEAN,

                    text: '[A] >= [B]',
                    arguments: {
                        A: {
                            type: Scratch.ArgumentType.NUMBER
                        },
                        B: {
                            type: Scratch.ArgumentType.NUMBER,
                            defaultValue: 50
                        }
                    }
                },
                {
                    opcode: 'trueBlock',
                    blockType: Scratch.BlockType.BOOLEAN,
                    text: 'true'
                },
                {
                    opcode: 'falseBlock',
                    blockType: Scratch.BlockType.BOOLEAN,
                    text: 'false'
                },
                {
                    opcode: 'exponent',

                    blockType: Scratch.BlockType.REPORTER,

                    text: '[A] ^ [B]',
                    arguments: {
                        A: {
                            type: Scratch.ArgumentType.NUMBER
                        },
                        B: {
                            type: Scratch.ArgumentType.NUMBER
                        }
                    }
                },
                {
                    opcode: 'pi',
                    blockType: Scratch.BlockType.REPORTER,
                    text: 'pi'
                },
                {
                    opcode: 'ternaryOperator',

                    blockType: Scratch.BlockType.REPORTER,

                    text: 'if [A] then [B] else [C]',
                    arguments: {
                        A: {
                            type: Scratch.ArgumentType.BOOLEAN
                        },
                        B: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'banana'
                        },
                        C: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'apple'
                        }
                    }
                },
                {
                    opcode: 'letters',

                    blockType: Scratch.BlockType.REPORTER,

                    text: 'letters [START] to [END] of [STRING]',
                    arguments: {
                        START: {
                            type: Scratch.ArgumentType.NUMBER,
                            defaultValue: 5
                        },
                        END: {
                            type: Scratch.ArgumentType.NUMBER,
                            defaultValue: 7
                        },
                        STRING: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'red apple'
                        }
                    }
                },
                {
                    opcode: 'currentMillisecond',
                    blockType: Scratch.BlockType.REPORTER,
                    text: 'current millisecond'
                },
                {
                    opcode: 'fetchFrom',

                    blockType: Scratch.BlockType.REPORTER,

                    text: 'get content from [URL]',
                    arguments: {
                        URL: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'https://api.scratch.mit.edu/users/griffpatch/messages/count'
                        }
                    }
                },
                {
                    opcode: 'parseJSON',

                    blockType: Scratch.BlockType.REPORTER,

                    text: '[PATH] of [JSON_STRING]',
                    arguments: {
                        PATH: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'fruit/apples'
                        },
                        JSON_STRING: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: '{"fruit": {"apples": 2, "bananas": 3}, "total_fruit": 5}'
                        }
                    }
                },
                {
                    opcode: 'stringToBoolean',

                    blockType: Scratch.BlockType.BOOLEAN,

                    text: '[STRING]',
                    arguments: {
                        STRING: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'true'
                        }
                    }
                },
                {
                    opcode: 'regexReplace',

                    blockType: Scratch.BlockType.REPORTER,

                    text: 'replace [STRING] using the rule [REGEX] with [NEWSTRING]',
                    arguments: {
                        STRING: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'bananas are awesome. i like bananas.'
                        },
                        REGEX: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'banana'
                        },
                        NEWSTRING: {
                            type: Scratch.ArgumentType.STRING,
                            defaultValue: 'apple'
                        }
                    }
                }
            ]
        }
    }
    isExactly({A, B}) {
        return A === B;
    }

    isLessOrEqual({A, B}) {
        return A <= B;
    }

    isMoreOrEqual({A, B}) {
        return A >= B;
    }

    trueBlock() {
        return true;
    }

    falseBlock() {
        return false;
    }

    exponent({A, B}) {
        return Math.pow(A, B);
    }

    pi() {
        return Math.PI;
    }

    ternaryOperator({A, B, C}) {
        return A ? B : C;
    }

    letters({STRING, START, END}) {
        return STRING.slice(Math.max(1, START) - 1, Math.min(STRING.length, END));
    }

    currentMillisecond() {
        return Date.now() % 1000;
    }

    fetchFrom({URL}) {
        return new Promise(resolve => {
            fetch(URL).then(res => res.text()).then(resolve)
                .catch(err => resolve(''));
        });
    }

    parseJSON({PATH, JSON_STRING}) {
        try {
            const path = PATH.toString().split('/').map(prop => decodeURIComponent(prop));
            if (path[0] === '') path.splice(0, 1);
            if (path[path.length - 1] === '') path.splice(-1, 1);
            let json;
            try {
                json = JSON.parse(' ' + JSON_STRING);
            } catch (e) {
                return e.message;
            }
            path.forEach(prop => json = json[prop]);
            if (json === null) return 'null';
            else if (json === undefined) return '';
            else if (typeof json === 'object') return JSON.stringify(json);
            else return json.toString();
        } catch (err) {
            return '';
        }
    }

    stringToBoolean({STRING}) {
        return STRING;
    }

    regexReplace({STRING, REGEX, NEWSTRING}) {
        return STRING.toString().replace(new RegExp(REGEX, 'gi'), NEWSTRING);
    }

}
Scratch.extensions.register(new Utilities());
